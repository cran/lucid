<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kevin Wright" />

<meta name="date" content="2018-08-24" />

<title>Lucid printing of floating-point vectors</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Lucid printing of floating-point vectors</h1>
<h4 class="author"><em>Kevin Wright</em></h4>
<h4 class="date"><em>2018-08-24</em></h4>



<style type="text/css">
body, td { font-size: 14pt; color: #000; padding:1em; }
code, pre, #ws, #message { font-size: 12pt;
  color: #000; background-color: #f5f5f5; }
code {border: 1px solid #e0e0e0; padding: 0 5px;}
pre > code { border: 0; }
</style>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;knitr&quot;</span>)
    opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">fig.align=</span><span class="st">&quot;center&quot;</span>, <span class="dt">fig.width=</span><span class="dv">6</span>, <span class="dt">fig.height=</span><span class="dv">6</span>)
<span class="kw">options</span>(<span class="dt">width=</span><span class="dv">90</span>)</code></pre></div>
</div>
<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p><span class="citation">A. B. Farquhar and Farquhar (1891)</span> provide a humorous quote about tables:</p>
<blockquote>
<p>The graphic method has considerable superiority for the exposition of statistical facts over the tabular. A heavy bank of figures is grievously wearisome to the eye, and the popular mind is as incapable of drawing any useful lessons from it as of extracting sunbeams from cucumbers.</p>
</blockquote>
<p>The <code>lucid</code> package intends to make your life easier by helping you extract information from tables. The package has functions for printing vectors and tables of floating-point numbers in a human-friendly format. An application is presented for printing of variance components from mixed models.</p>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Numerical output from R is often in scientific notation, which can make it difficult to quickly glance at numbers and understand the relative sizes of the numbers. This not a new phenomenon. Before R had been created, <span class="citation">Finney (1988)</span> had this to say about numerical output:</p>
<blockquote>
<p>Certainly, in initiating analyses by standard software or in writing one’s own software, the aim should be to have output that is easy to read and easily intelligible to others. … Especially undesirable is the so-called ‘scientific notation’ for numbers in which every number is shown as a value between 0.0 and 1.0 with a power of 10 by which it must be multiplied. For example:</p>
<pre><code>0.1234E00 is 0.1234
0.1234E02 is 12.34
0.1234E-1 is 0.01234</code></pre>
<p>This is an abomination which obscures the comparison of related quantities; tables of means or of analyses of variance become very difficult to read. It is acceptable as a default when a value is unexpectedly very much larger or smaller than its companions, but its appearance as standard output denotes either lazy programming or failure to use good software properly. Like avoidance of ‘E’, neat arrangement of output values in columns, with decimal points on a vertical line, requires extra effort by a programmer but should be almost mandatory for any software that is to be used often.</p>
</blockquote>
<p>One recommendation for improving the display of tables of numbers is to round numbers to 2 <span class="citation">(Wainer 1997)</span> or 3 <span class="citation">(Feinberg and Wainer 2011, <span class="citation">Clark (1965)</span>)</span> digits for the following reasons:</p>
<ol style="list-style-type: decimal">
<li>We cannot <em>comprehend</em> more than three digits very easily.</li>
<li>We seldom <em>care</em> about accuracy of more than three digits.</li>
<li>We can rarely <em>justify</em> more than three digits of accuracy statistically.</li>
</ol>
<p>An alternative to significant digits is the concept of <em>effective digits</em> <span class="citation">(Ehrenberg 1977, <span class="citation">Kozak et al. (2011)</span>)</span>, which considers the amount of variation in the data.</p>
<p>In R, the <code>round()</code> and <code>signif()</code> functions can be used to round to 3 digits of accuracy, but those functions can still print results in scientific notation and leave much to be desired. The <code>lucid</code> package provides functions to improve the presentation of floating point numbers in a clear (or lucid) way that makes interpretation of the numbers immediately apparent.</p>
<p>Consider the following vector of coefficients from a fitted model:</p>
<pre><code>##                    effect
## (Intercept)  1.135000e+02
## A           -1.350000e+01
## B            4.500000e+00
## C            2.450000e+01
## C1           6.927792e-14
## C2          -1.750000e+00
## D            1.650000e+01</code></pre>
<p>Questions of interest about the coefficients might include:</p>
<ol style="list-style-type: decimal">
<li>Which coefficient is zero?</li>
<li>How large is the intercept?</li>
</ol>
<p>Both questions can be answered using the output shown above, but it takes too much effort to answer the questions. Now examine the same vector of coefficients with prettier formatting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">&quot;lucid&quot;</span>)
<span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">7</span>) <span class="co"># knitr defaults to 4, R console uses 7</span>
<span class="kw">lucid</span>(df1)</code></pre></div>
<pre><code>##             effect
## (Intercept) 114   
## A           -13.5 
## B             4.5 
## C            24.5 
## C1            0   
## C2           -1.75
## D            16.5</code></pre>
<p>Which coefficient is zero? How large is the intercept?</p>
<p>Printing the numbers with the <code>lucid()</code> function has made the questions much easier to answer.</p>
<p>The sequence of steps used by <code>lucid()</code> to format and print the output is.</p>
<ol style="list-style-type: decimal">
<li>Zap small numbers to zero using <code>zapsmall()</code>.</li>
<li>Round using 3 significant digits (user controllable option).</li>
<li>Drop trailing zeros.</li>
<li>Align numbers at the decimal point (text format).</li>
</ol>
<p>The <code>lucid</code> package contains a generic function <code>lucid()</code> with specific methods for numeric vectors, data frames, and lists. The method for data frames applies formatting to each numeric column and leaves other columns unchanged. The <code>lucid()</code> function is primarily a <em>formatting</em> function, the results of which are passed to the regular <code>print()</code> functions.</p>
</div>
<div id="example-antibiotic-effectiveness" class="section level2">
<h2>Example: Antibiotic effectiveness</h2>
<p><span class="citation">Wainer and Larsen (2009)</span> present data published by Will Burtin in 1951 on the effectiveness of antibiotics against 16 types of bacteria. The data is included in the <code>lucid</code> package as a dataframe called <code>antibiotic</code>. The default view of this data is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(antibiotic)</code></pre></div>
<pre><code>##                      bacteria penicillin streptomycin neomycin gramstain
## 1        Aerobacter aerogenes    870.000         1.00    1.600       neg
## 2            Brucella abortus      1.000         2.00    0.020       neg
## 3            Escherichia coli    100.000         0.40    0.100       neg
## 4       Klebsiella pneumoniae    850.000         1.20    1.000       neg
## 5  Mycobacterium tuberculosis    800.000         5.00    2.000       neg
## 6            Proteus vulgaris      3.000         0.10    0.100       neg
## 7      Pseudomonas aeruginosa    850.000         2.00    0.400       neg
## 8          Salmonella typhosa      1.000         0.40    0.008       neg
## 9   Salmonella schottmuelleri     10.000         0.80    0.090       neg
## 10         Bacillis anthracis      0.001         0.01    0.007       pos
## 11     Diplococcus pneumoniae      0.005        11.00   10.000       pos
## 12       Staphylococcus albus      0.007         0.10    0.001       pos
## 13      Staphylococcus aureus      0.030         0.03    0.001       pos
## 14      Streptococcus fecalis      1.000         1.00    0.100       pos
## 15  Streptococcus hemolyticus      0.001        14.00   10.000       pos
## 16     Streptococcus viridans      0.005        10.00   40.000       pos</code></pre>
<p>Due to the wide range in magnitude of the values, nearly half of the floating-point numbers in the default view contain trailing zeros after the decimal, which adds significant clutter and impedes interpretation. The <code>lucid()</code> display of the data is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lucid</span>(antibiotic)</code></pre></div>
<pre><code>##                      bacteria penicillin streptomycin neomycin gramstain
## 1        Aerobacter aerogenes    870             1       1.6         neg
## 2            Brucella abortus      1             2       0.02        neg
## 3            Escherichia coli    100             0.4     0.1         neg
## 4       Klebsiella pneumoniae    850             1.2     1           neg
## 5  Mycobacterium tuberculosis    800             5       2           neg
## 6            Proteus vulgaris      3             0.1     0.1         neg
## 7      Pseudomonas aeruginosa    850             2       0.4         neg
## 8          Salmonella typhosa      1             0.4     0.008       neg
## 9   Salmonella schottmuelleri     10             0.8     0.09        neg
## 10         Bacillis anthracis      0.001         0.01    0.007       pos
## 11     Diplococcus pneumoniae      0.005        11      10           pos
## 12       Staphylococcus albus      0.007         0.1     0.001       pos
## 13      Staphylococcus aureus      0.03          0.03    0.001       pos
## 14      Streptococcus fecalis      1             1       0.1         pos
## 15  Streptococcus hemolyticus      0.001        14      10           pos
## 16     Streptococcus viridans      0.005        10      40           pos</code></pre>
<p>The <code>lucid()</code> display is dramatically simplified, providing a clear picture of the effectiveness of the antibiotics against bacteria. This view of the data matches exactly the appearance of Table 1 in <span class="citation">Wainer and Larsen (2009)</span>.</p>
<p>A stem-and-leaf plot is a semi-graphical display of data, in that the <em>positions</em> of the numbers create a display similar to a histogram. In a similar manner, the <code>lucid()</code> output is a semi-graphical view of the data. The figure below shows a dotplot of the penicillin values on a reverse log10 scale. The values are also shown along the right axis in <code>lucid()</code> format. Note the similarity in the overall shape of the dots and the positions of the left-most significant digit in the numerical values along the right axis. <img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="example-using-lucid-with-broom" class="section level2">
<h2>Example: Using <code>lucid</code> with <code>broom</code></h2>
<p>The <code>broom</code> package by <span class="citation">Robinson (2016)</span> can be used to collect statistics from fitted models into tidy data frames. For example, using the <code>Orange</code> tree data, it is possible to fit a separate regression line for each tree. (The straight-line regression here is not entirely sensible, but illustrates a point.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(dplyr)</code></pre></div>
<pre><code>## Loading required package: dplyr</code></pre>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(broom)</code></pre></div>
<pre><code>## Loading required package: broom</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Orange <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Tree) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(circumference <span class="op">~</span><span class="st"> </span>age, <span class="dt">data=</span>.)))</code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   Tree [5]
##    Tree  term        estimate std.error statistic   p.value
##    &lt;ord&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 3     (Intercept)  19.2      5.86         3.28 0.0221   
##  2 3     age           0.0811   0.00563     14.4  0.0000290
##  3 1     (Intercept)  24.4      6.54         3.73 0.0135   
##  4 1     age           0.0815   0.00628     13.0  0.0000485
##  5 5     (Intercept)   8.76     8.18         1.07 0.333    
##  6 5     age           0.111    0.00785     14.1  0.0000318
##  7 2     (Intercept)  20.0      9.35         2.13 0.0859   
##  8 2     age           0.125    0.00898     13.9  0.0000343
##  9 4     (Intercept)  14.6     11.2          1.30 0.249    
## 10 4     age           0.135    0.0108      12.5  0.0000573</code></pre>
<p>Extracting information from the sea of numbers above is difficult. The <code>lucid</code> function comes to the rescue, simply by adding one more step to the sequence of pipes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Orange <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Tree) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">tidy</span>(<span class="kw">lm</span>(circumference <span class="op">~</span><span class="st">  </span>age, <span class="dt">data=</span>.))) <span class="op">%&gt;%</span><span class="st"> </span>lucid</code></pre></div>
<pre><code>##    Tree        term estimate std.error statistic   p.value
## 1     3 (Intercept)  19.2      5.86         3.28 0.0221   
## 2     3         age   0.0811   0.00563     14.4  0.000029 
## 3     1 (Intercept)  24.4      6.54         3.73 0.0135   
## 4     1         age   0.0815   0.00628     13    0.0000485
## 5     5 (Intercept)   8.76     8.18         1.07 0.333    
## 6     5         age   0.111    0.00785     14.1  0.0000318
## 7     2 (Intercept)  20        9.35         2.13 0.0859   
## 8     2         age   0.125    0.00898     13.9  0.0000343
## 9     4 (Intercept)  14.6     11.2          1.3  0.249    
## 10    4         age   0.135    0.0108      12.5  0.0000573</code></pre>
<p>After formatting, information in the table almost jumps out at the reader, reducing the amount of cognitive effort needed for interpretation.</p>
</div>
<div id="example-application-to-mixed-models" class="section level2">
<h2>Example: Application to mixed models</h2>
<p>During the process of iterative fitting of mixed models, it is often useful to compare fits of different models to data, for example using loglikelihood or AIC values, or with the help of residual plots. It can also be very informative to inspect the estimated values of variance components.</p>
<p>To that end, the generic <code>VarCorr()</code> function found in the <code>nlme</code> <span class="citation">Pinheiro et al. (2014)</span> and <code>lme4</code> <span class="citation">Bates et al. (2014)</span> packages can be used to print variance estimates from fitted models. The <code>VarCorr()</code> function is not available for models obtained using the <code>asreml</code> <span class="citation">Butler (2009)</span> package.</p>
<p>The <code>lucid</code> package provides a generic function called <code>vc()</code> that provides a unified interface for extracting the variance components from fitted models obtained from the <code>asreml</code>, <code>lme4</code>, <code>nlme</code>, and <code>rjags</code> packages. The <code>vc()</code> function has methods specific to each package that make it easy to extract the estimated variances and correlations from fitted models and formats the results using the <code>lucid()</code> function.</p>
<p><span class="citation">Pearce et al. (1988)</span> suggest showing four significant digits for the error mean square and two decimal places digits for <span class="math inline">\(F\)</span> values. The <code>lucid()</code> function uses a similar philosophy, presenting the variances with four significant digits and <code>asreml</code> <span class="math inline">\(Z\)</span> statistics with two significant digits.</p>
<div id="vc-example-1---rail-data" class="section level3">
<h3>vc() example 1 - Rail data</h3>
<p>The following simple example illustrates use of the <code>vc()</code> function for identical REML models in the <code>nlme</code>, <code>lme4</code>, and <code>asreml</code> packages. The travel times of ultrasonic waves in six steel rails was modeled as an overall mean, a random effect for each rail, and a random residual. The package <code>rjags</code> is used to fit a similar Bayesian model inspired by <span class="citation">Wilkinson (2014)</span>.</p>
</div>
</div>
<div id="nlme" class="section level2">
<h2>nlme</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">&quot;nlme&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## 
## Attaching package: 'nlme'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     collapse</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Rail)
mn &lt;-<span class="st"> </span><span class="kw">lme</span>(travel<span class="op">~</span><span class="dv">1</span>, <span class="dt">random=</span><span class="op">~</span><span class="dv">1</span><span class="op">|</span>Rail, <span class="dt">data=</span>Rail)
<span class="kw">vc</span>(mn)</code></pre></div>
<pre><code>##       effect variance stddev
##  (Intercept)   615.3  24.81 
##     Residual    16.17  4.021</code></pre>
</div>
<div id="lme4" class="section level1">
<h1>lme4</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">&quot;lme4&quot;</span>)</code></pre></div>
<pre><code>## Loading required package: lme4</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: 'lme4'</code></pre>
<pre><code>## The following object is masked from 'package:nlme':
## 
##     lmList</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m4 &lt;-<span class="st"> </span><span class="kw">lmer</span>(travel<span class="op">~</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span><span class="op">|</span>Rail), <span class="dt">data=</span>Rail)
<span class="kw">vc</span>(m4)</code></pre></div>
<pre><code>##       grp        var1 var2   vcov  sdcor
##      Rail (Intercept) &lt;NA&gt; 615.3  24.81 
##  Residual        &lt;NA&gt; &lt;NA&gt;  16.17  4.021</code></pre>
</div>
<div id="asreml" class="section level1">
<h1>asreml</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># require(&quot;asreml&quot;)</span>
<span class="co"># ma &lt;- asreml(travel~1, random=~Rail, data=Rail)</span>
<span class="co"># vc(ma)</span>
##         effect component std.error z.ratio constr
##  Rail!Rail.var    615.3      392.6     1.6    pos
##     R!variance     16.17       6.6     2.4    pos</code></pre></div>
</div>
<div id="jags" class="section level1">
<h1>JAGS</h1>
<p>In a Bayesian model all effects can be considered as random.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(<span class="st">&quot;nlme&quot;</span>)
<span class="kw">data</span>(Rail)
<span class="kw">require</span>(<span class="st">&quot;rjags&quot;</span>)
m5 &lt;-
<span class="st">&quot;model {</span>
<span class="st">for(i in 1:nobs){</span>
<span class="st">  travel[i] ~ dnorm(mu + theta[Rail[i]], tau)</span>
<span class="st">}</span>
<span class="st">for(j in 1:6) {</span>
<span class="st">  theta[j] ~ dnorm(0, tau.theta)</span>
<span class="st">}</span>
<span class="st">mu ~ dnorm(50, 0.0001) # Overall mean. dgamma() </span>
<span class="st">tau ~ dgamma(1, .001)</span>
<span class="st">tau.theta ~ dgamma(1, .001)</span>
<span class="st">residual &lt;- 1/sqrt(tau)</span>
<span class="st">sigma.rail &lt;- 1/sqrt(tau.theta)</span>
<span class="st">}&quot;</span>
jdat &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">nobs=</span><span class="kw">nrow</span>(Rail), <span class="dt">travel=</span>Rail<span class="op">$</span>travel, <span class="dt">Rail=</span>Rail<span class="op">$</span>Rail)
jinit &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">mu=</span><span class="dv">50</span>, <span class="dt">tau=</span><span class="dv">1</span>, <span class="dt">tau.theta=</span><span class="dv">1</span>)
tc5 &lt;-<span class="st"> </span><span class="kw">textConnection</span>(m5)
j5 &lt;-<span class="st"> </span><span class="kw">jags.model</span>(tc5, <span class="dt">data=</span>jdat, <span class="dt">inits=</span>jinit, <span class="dt">n.chains=</span><span class="dv">2</span>, <span class="dt">quiet=</span><span class="ot">TRUE</span>)
<span class="kw">close</span>(tc5)
c5 &lt;-<span class="st"> </span><span class="kw">coda.samples</span>(j5, <span class="kw">c</span>(<span class="st">&quot;mu&quot;</span>,<span class="st">&quot;theta&quot;</span>, <span class="st">&quot;residual&quot;</span>, <span class="st">&quot;sigma.rail&quot;</span>), 
                   <span class="dt">n.iter=</span><span class="dv">100000</span>, <span class="dt">thin=</span><span class="dv">5</span>, <span class="dt">progress.bar=</span><span class="st">&quot;none&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vc</span>(c5)</code></pre></div>
<pre><code>##               Mean      SD    2.5% Median   97.5%
## mu          65.75  10.05    44.97   65.86  85.37 
## residual     3.948  0.8187   2.729   3.82   5.908
## sigma.rail  23.44   7.622   13.67   21.88  42.64 
## theta[1]   -33.65  10.22   -53.72  -33.71 -12.6  
## theta[2]   -15.54  10.22   -35.46  -15.64   5.528
## theta[3]   -11.61  10.2    -31.58  -11.7    9.26 
## theta[4]    16.71  10.22    -3.106  16.51  37.68 
## theta[5]    18.69  10.24    -1.234  18.53  39.81 
## theta[6]    29.87  10.24    10.01   29.7   51.18</code></pre>
<p>Compare the JAGS point estimates and quantiles (above) with the results from <code>lme4</code> below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m4</code></pre></div>
<pre><code>## Linear mixed model fit by REML ['lmerMod']
## Formula: travel ~ 1 + (1 | Rail)
##    Data: Rail
## REML criterion at convergence: 122.177
## Random effects:
##  Groups   Name        Std.Dev.
##  Rail     (Intercept) 24.805  
##  Residual              4.021  
## Number of obs: 18, groups:  Rail, 6
## Fixed Effects:
## (Intercept)  
##        66.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ranef</span>(m4)</code></pre></div>
<pre><code>## $Rail
##   (Intercept)
## 2   -34.53091
## 5   -16.35675
## 1   -12.39148
## 6    16.02631
## 3    18.00894
## 4    29.24388</code></pre>
<p>While the <code>lucid()</code> function is primarily a formatting function and uses the standard <code>print()</code> functions in R, the <code>vc()</code> function defines an additional class for the value of the function and has dedicated <code>print</code> methods for the class. This was done to allow additional formatting of the results.</p>
<div id="vc-example-2---analysis-of-federer.diagcheck-data" class="section level3">
<h3>vc() example 2 - Analysis of federer.diagcheck data</h3>
<p>The second, more complex example is based on a model in <span class="citation">Federer and Wolfinger (2003)</span> in which orthogonal polynomials are used to model trends along the rows and columns of a field experiment. The data are available in the <code>agridat</code> package <span class="citation">(Wright 2014)</span> as the <code>federer.diagcheck</code> data frame. The help page for that data shows how to reproduce the analysis of <span class="citation">Federer and Wolfinger (2003)</span>. When using the <code>lme4</code> package to reproduce the analysis, two different optimizers are available. Do the two different optimizers lead to similar estimated variances?</p>
<p>In the output below, the first column identifies terms in the model, the next two columns are the variance and standard deviation from the ‘bobyqa’ optimizer, while the final two columns are from the ‘NelderMead’ optimizer. Note, these results are from <code>lme4</code> version 1.1-7 and are likely to be different than the results from more recent versions of <code>lme4</code>.</p>
<p>The default output printing is shown first.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(out)</code></pre></div>
<pre><code>##           term     vcov-bo  sdcor-bo sep      vcov-ne     sdcor-ne
## 1  (Intercept)   2869.4469  53.56722     3.228419e+03  56.81917727
## 2        r1:c3   5531.5724  74.37454     7.688139e+03  87.68203447
## 3        r1:c2  58225.7678 241.30016     6.974755e+04 264.09761622
## 4        r1:c1 128004.1561 357.77668     1.074270e+05 327.76064925
## 5           c8   6455.7495  80.34768     6.787004e+03  82.38327224
## 6           c6   1399.7294  37.41296     1.636128e+03  40.44907560
## 7           c4   1791.6507  42.32790     1.226846e+04 110.76308194
## 8           c3   2548.8847  50.48648     2.686302e+03  51.82954364
## 9           c2   5941.7908  77.08301     7.644730e+03  87.43414634
## 10          c1      0.0000   0.00000     1.225143e-03   0.03500204
## 11         r10   1132.9501  33.65932     1.975505e+03  44.44665149
## 12          r8   1355.2291  36.81344     1.241429e+03  35.23391157
## 13          r4   2268.7296  47.63118     2.811241e+03  53.02113582
## 14          r2    241.7894  15.54958     9.282275e+02  30.46682578
## 15          r1   9199.9022  95.91612     1.036358e+04 101.80169429
## 16        &lt;NA&gt;   4412.1096  66.42371     4.126832e+03  64.24042100</code></pre>
<p>How similar are the variance estimates obtained from the two optimization methods? It is difficult to compare the results due to the clutter of extra digits, and because of some quirks in the way R formats the output. The variances in column 2 are shown in non-scientific format, while the variances in column 5 are shown in scientific format. The standard deviations are shown with 5 decimal places in column 3 and 8 decimal places in column 6. (All numbers were stored with 15 digits of precision.)</p>
<p>The <code>lucid()</code> function is now used to show the results in the manner of the <code>vc()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lucid</span>(out, <span class="dt">dig=</span><span class="dv">4</span>)</code></pre></div>
<pre><code>##           term  vcov-bo sdcor-bo sep  vcov-ne sdcor-ne
## 1  (Intercept)   2869      53.57       3228     56.82 
## 2        r1:c3   5532      74.37       7688     87.68 
## 3        r1:c2  58230     241.3       69750    264.1  
## 4        r1:c1 128000     357.8      107400    327.8  
## 5           c8   6456      80.35       6787     82.38 
## 6           c6   1400      37.41       1636     40.45 
## 7           c4   1792      42.33      12270    110.8  
## 8           c3   2549      50.49       2686     51.83 
## 9           c2   5942      77.08       7645     87.43 
## 10          c1      0       0             0      0.035
## 11         r10   1133      33.66       1976     44.45 
## 12          r8   1355      36.81       1241     35.23 
## 13          r4   2269      47.63       2811     53.02 
## 14          r2    241.8    15.55        928.2   30.47 
## 15          r1   9200      95.92      10360    101.8  
## 16        &lt;NA&gt;   4412      66.42       4127     64.24</code></pre>
<p>The formatting of the variance columns is consistent as is the formatting of the standard deviation columns. Fewer digits are shown. It is easy to compare the columns and see that the two optimizers are giving quite different answers. Note: The Bobyqa results are almost identical to the results obtained when using ASREML or SAS.</p>
<p>Note: Data frames have no quotes, but numeric matrices are printed with quotes. Use <code>noquote()</code> to print without quotes, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">noquote</span>(<span class="kw">lucid</span>(<span class="kw">as.matrix</span>(<span class="kw">head</span>(mtcars)),<span class="dv">2</span>))</code></pre></div>
<pre><code>##                   mpg cyl disp hp  drat wt  qsec vs am gear carb
## Mazda RX4         21  6   160  110 3.9  2.6 16   0  1  4    4   
## Mazda RX4 Wag     21  6   160  110 3.9  2.9 17   0  1  4    4   
## Datsun 710        23  4   110   93 3.8  2.3 19   1  1  4    1   
## Hornet 4 Drive    21  6   260  110 3.1  3.2 19   1  0  3    1   
## Hornet Sportabout 19  8   360  180 3.2  3.4 17   0  0  3    2   
## Valiant           18  6   220  100 2.8  3.5 20   1  0  3    1</code></pre>
</div>
<div id="references" class="section level2 unnumbered">
<h2>References</h2>
<div id="refs" class="references">
<div id="ref-bates2014lme4">
<p>Bates, Douglas, Martin Maechler, Ben Bolker, and S. Walker. 2014. <em>lme4: Linear mixed-effects models using Eigen and S4</em>. <a href="https://CRAN.R-project.org/package=lme4" class="uri">https://CRAN.R-project.org/package=lme4</a>.</p>
</div>
<div id="ref-butler2009asreml">
<p>Butler, David. 2009. <em>asreml: asreml() fits the linear mixed model</em>. <a href="www.vsni.co.uk" class="uri">www.vsni.co.uk</a>.</p>
</div>
<div id="ref-clark1965presentation">
<p>Clark, R. T. 1965. “The Presentation of Numerical Results of Experiments for Publication in a Scientific Agricultural Journal.” <em>Experimental Agriculture</em> 1: 315–19.</p>
</div>
<div id="ref-ehrenberg1977rudiments">
<p>Ehrenberg, A. S. C. 1977. “Rudiments of Numeracy.” <em>Journal of the Royal Statistical Society. Series A</em>, 277–97. doi:<a href="https://doi.org/10.2307/2344922">10.2307/2344922</a>.</p>
</div>
<div id="ref-farquhar1891economic">
<p>Farquhar, Arthur B., and Henry Farquhar. 1891. <em>Economic and Industrial Delusions</em>. New York: G. P. Putnam’s Sons. <a href="https://books.google.com/books?id=BHkpAAAAYAAJ" class="uri">https://books.google.com/books?id=BHkpAAAAYAAJ</a>.</p>
</div>
<div id="ref-federer2003proc">
<p>Federer, Walter T., and Russell D. Wolfinger. 2003. “Handbook of Formulas and Software for Plant Geneticists and Breeders.” In, edited by Manjit Kang. Haworth Press.</p>
</div>
<div id="ref-feinberg2011extracting">
<p>Feinberg, Richard A., and Howard Wainer. 2011. “Extracting Sunbeams from Cucumbers.” <em>Journal of Computational and Graphical Statistics</em> 20 (4): 793–810. doi:<a href="https://doi.org/10.1198/jcgs.2011.204a">10.1198/jcgs.2011.204a</a>.</p>
</div>
<div id="ref-finney1988data">
<p>Finney, D. J. 1988. “Was This in Your Statistics Textbook? II. Data Handling.” <em>Experimental Agriculture</em> 24: 343–53. doi:<a href="https://doi.org/10.1017/S0014479700016197">10.1017/S0014479700016197</a>.</p>
</div>
<div id="ref-kozak2011reporting">
<p>Kozak, Marcin, Ricardo Antunes Azevedo, Justyna Jupowicz-Kozak, and Wojtek Krzanowski. 2011. “Reporting Numbers in Agriculture and Biology: Don’t Overdo the Digits.” <em>Australian Journal of Crop Science</em> 5: 1876–81. <a href="http://www.cropj.com/kozak_5_13_2011_1876_1881.pdf" class="uri">http://www.cropj.com/kozak_5_13_2011_1876_1881.pdf</a>.</p>
</div>
<div id="ref-pearce1988manual">
<p>Pearce, S. C., G. M. Clarke, G. V. Dyke, and R. E. Kempson. 1988. <em>A Manual of Crop Experimentation</em>. Charles Griffin; Company.</p>
</div>
<div id="ref-pinheiro2014nlme">
<p>Pinheiro, Jose, Douglas Bates, Saikat DebRoy, Deepayan Sarkar, and R Core Team. 2014. <em>nlme: Linear and Nonlinear Mixed Effects Models</em>. <a href="https://CRAN.R-project.org/package=nlme" class="uri">https://CRAN.R-project.org/package=nlme</a>.</p>
</div>
<div id="ref-robinson2016broom">
<p>Robinson, David. 2016. <em>broom: Convert Statistical Analysis Objects into Tidy Data Frames</em>. <a href="https://CRAN.R-project.org/package=broom" class="uri">https://CRAN.R-project.org/package=broom</a>.</p>
</div>
<div id="ref-wainer1997improving">
<p>Wainer, Howard. 1997. “Improving Tabular Displays, with NAEP Tables as Examples and Inspirations.” <em>Journal of Educational and Behavioral Statistics</em> 22. Sage Publications: 1–30. doi:<a href="https://doi.org/10.3102/10769986022001001">10.3102/10769986022001001</a>.</p>
</div>
<div id="ref-wainer2009pictures">
<p>Wainer, Howard, and Mike Larsen. 2009. “Pictures at an Exhibition.” <em>Chance</em> 22 (2): 46–54. doi:<a href="https://doi.org/10.1080/09332480.2009.10722958">10.1080/09332480.2009.10722958</a>.</p>
</div>
<div id="ref-wilkinson2014oneway">
<p>Wilkinson, Darren. 2014. “One-Way Anova with Fixed and Random Effects from a Bayesian Perspective.” <a href="https://darrenjw.wordpress.com/2014/12/22/one-way-anova-with-fixed-and-random-effects-from-a-bayesian-perspective/" class="uri">https://darrenjw.wordpress.com/2014/12/22/one-way-anova-with-fixed-and-random-effects-from-a-bayesian-perspective/</a>.</p>
</div>
<div id="ref-wright2014agridat">
<p>Wright, Kevin. 2014. <em>Agridat: Agricultural Datasets</em>. <a href="https://CRAN.R-project.org/package=agridat" class="uri">https://CRAN.R-project.org/package=agridat</a>.</p>
</div>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
